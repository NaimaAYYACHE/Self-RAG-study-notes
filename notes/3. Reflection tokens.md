# SELF-RAG â€” Self-Reflective Retrieval-Augmented Generation â€” **Reflection Tokens in SELF-RAG**

**Reflection tokens** are **special markers** that help the model **analyze and monitor its own reasoning process** during generation.

They tell the model *how **confident, supported**, or **relevant*** its statements are.


## ðŸ§© **Main Reflection Tokens**

| Token | Meaning | Purpose |
| --- | --- | --- |
| `[RETRIEVE]` | Indicates if the model should fetch external information ðŸ” | Ensures answers are factually supported by relevant documents âœ… |
| `[ISREL]` | Is the **retrieved document relevant** ? ðŸ“š | Judges if the **retrieved doc** actually helps **answer the question.** |
| `[ISSUP]` | Is the statement **supported** by evidence ***( retrieved doc)***? âœ… | Marks whether the **generated answer**  matches **retrieved docs.** |
| `[ISUSE]` | How **useful** the document is for answering â­ | Measures doc usefulness (e.g., 1â€“5 scale). |

## ðŸ” **[RETRIEVE] â€” â€œShould I look something up?â€**

### ðŸ§  **Meaning**

The `[RETRIEVE]` token tells the model **when to search for external information** (from a knowledge base, documents, or database).

Itâ€™s like the model saying to itself:

> â€œHmmâ€¦ Iâ€™m not sure enough â€” I should check the facts before answering.â€
> 

---

### âš™ï¸ **When the model uses [RETRIEVE]**

- When the **question is factual**, and the model **isnâ€™t confident in its memory** â“
- When it needs **up-to-date or detailed info** that might **not** be in **its internal knowledge** ðŸ—‚ï¸
- It can also **skip retrieval** if itâ€™s **confident** â†’ `[RETRIEVE=NO]` ðŸš«

---

### âš½ **Example 1: Morocco in the World Cup**

### ðŸ² **Example 2: How to make couscous**

> User: â€œHow did Morocco perform in the 2022 FIFA World Cup?â€ ðŸ‡²ðŸ‡¦âš½
> 

**Model thinking:**

> â€œHmm, thatâ€™s a factual eventâ€¦ I might not remember the details.â€ ðŸ¤”
> 

So it triggers retrieval:

```
**[RETRIEVE]**
(retrieves FIFA articles ðŸ“„)
Finds: â€œMorocco reached the semifinals.â€
Generates: â€œMorocco became the first African team to reach the World Cup semifinals.â€

```

âœ… **Result:** Retrieval was necessary because the model needed ***real-world data*.**

> User: â€œHow do Moroccans traditionally prepare couscous?â€ ðŸ²ðŸ‡²ðŸ‡¦
> 

**Model thinking:**

> â€œI already know the general recipe â€” I donâ€™t need to look it up.â€ ðŸ˜Ž
> 

So it skips retrieval:

```
**[RETRIEVE=NO]**
Generates: â€œMoroccan couscous is steamed semolina served with vegetables and meat, usually on Fridays.â€

```

âœ… **Result:** No retrieval needed â€” **the answer relies on stored cultural knowledge.**

---

### ðŸ’¡ **Summary**

| Mode | Token | Description | Example |
| --- | --- | --- | --- |
| Retrieve | `[RETRIEVE]` | Model decides to look for info ðŸ” | Morocco in World Cup âš½ |
| Skip | `[RETRIEVE=NO]` | Model confident, no search ðŸš« | Moroccan couscous ðŸ² |

### ðŸ§© **In short**

**[RETRIEVE]** = the modelâ€™s *curiosity switch* ðŸª„

It tells the system:

> â€œDo I know this, or should I check before I speak?â€ ðŸ§ ðŸ”
> 

---

## âœ… **[ISREL] â€” â€œIs this document relevant?â€**

### ðŸ§  **Meaning**

The `[ISREL]` token helps the model **judge how relevant** a retrieved document or passage is to the userâ€™s question.

Itâ€™s like the model saying:

> â€œI found some infoâ€¦ but is it actually about what the user asked?â€ ðŸ¤”
> 

---

### âš™ï¸ **When the model uses [ISREL]**

- After **retrieving** several documents ðŸ“š
- It checks each one and decides:
    - `[ISREL=1]` âœ… â†’ The doc is **relevant** to the question
    - `[ISREL=0]` ðŸš« â†’ The doc is **irrelevant** or off-topic

This helps the model **focus only on useful evidence** for generating the final answer ðŸ’¡

---

### âš½ **Example 1: Morocco in the 2022 World Cup** ðŸ‡²ðŸ‡¦âš½

> User: â€œHow did Morocco perform in the 2022 World Cup?â€
> 

**Model retrieves two documents:**

1ï¸âƒ£ Doc A: â€œMorocco reached the semifinals after defeating Portugal.â€

2ï¸âƒ£ Doc B: â€œFrance won the 2018 World Cup.â€

**Model evaluation:**

```
Doc A â†’ [ISREL=1] âœ… (directly about Morocco 2022)
Doc B â†’ [ISREL=0] ðŸš« (irrelevant year/event)
```

âœ… It then focuses on **Doc A** to generate:

> â€œMorocco became the first African team to reach the semifinals in 2022.â€ âš½ðŸŒ
> 

### ðŸœï¸ **Example 2: Moroccoâ€™s desert climate** â˜€ï¸ðŸœï¸

> User: â€œWhat kind of climate does Morocco have?â€
> 

**Model retrieves:**

1ï¸âƒ£ Doc A: â€œMorocco has a Mediterranean climate in the north and desert climate in the south.â€

2ï¸âƒ£ Doc B: â€œMoroccoâ€™s football team made history in 2022.â€

**Model evaluation:**

```
Doc A â†’ [ISREL=1] âœ…
Doc B â†’ [ISREL=0] ðŸš«
```

âœ… Only **Doc A** is used to generate:

> â€œMorocco has a mix of Mediterranean and desert climates.â€ ðŸŒ¦ï¸ðŸŒµ
> 

---

### ðŸ’¡ **Summary**

| Token | Meaning | Example | Decision |
| --- | --- | --- | --- |
| `[ISREL=1]` | Doc is relevant to the query âœ… | Morocco in 2022 World Cup | Keep it |
| `[ISREL=0]` | Doc is irrelevant ðŸš« | France 2018 World Cup | Ignore it |

### ðŸ§© **In short**

**[ISREL]** = the modelâ€™s *focus filter* ðŸŽ¯

It helps the generator **ignore noise** and **keep only the right context**:

> â€œIs this really about what the user asked?â€ ðŸ§âœ…
> 

---

## ðŸ“– **[ISSUP] â€” â€œIs this statement supported by evidence?â€**

### ðŸ§  **Meaning**

The `[ISSUP]` token helps the model decide **whether what itâ€™s saying is truly backed by the retrieved documents** ðŸ§¾ðŸ”.

Itâ€™s like the model asking itself:

> â€œCan I prove what I just said with evidence ? (retrieved docs)â€ ðŸ¤”ðŸ“š
> 

---

### âš™ï¸ **When the model uses [ISSUP]**

- After **retrieving** and **checking relevance** (`[ISREL]`) âœ…
- The model reads the selected docs and compares them to its own generated statements ðŸ§©
- Then it assigns:
    - `[ISSUP=1]` âœ… â†’ statement is **supported** by evidence
    - `[ISSUP=0]` ðŸš« â†’ statement is **unsupported** or **contradicted**

This token teaches the model to **speak only when it has proof** ðŸ“Š

---

### âš½ **Example 1: Morocco in the 2022 World Cup** ðŸ‡²ðŸ‡¦âš½

> User: â€œDid Morocco reach the semifinals in the 2022 World Cup?â€ ðŸ†
> 

**Model reasoning:**

```
Iâ€™m not 100% sure ðŸ¤” â†’ [RETRIEVE=YES] ðŸ”
(retrieves FIFA 2022 documents ðŸ“‘)
```

**Model retrieves:**

- Doc A: â€œMorocco reached the semifinals after defeating Portugal.â€
- Doc B: â€œCroatia won the third-place match against Morocco.â€

**Model evaluation:**

```
Doc A â†’ [ISREL=1] âœ…
Doc B â†’ [ISREL=1] âœ…

```

**Generated statement:**

> â€œMorocco reached the semifinals in the 2022 World Cup.â€ âš½ðŸ‡²ðŸ‡¦
> 

**Support check:**

```
Statement matches Doc A â†’ [ISSUP=1] âœ…
```

âœ… So the model marks it as supported and confident:

> â€œ[RETRIEVE] Morocco reached the semifinals in the 2022 World Cup. [ISSUP=1] âœ…â€
> 

---

### ðŸ”ï¸ **Example 2: Moroccoâ€™s mountains** â›°ï¸ðŸ‡²ðŸ‡¦

> User: â€œIs the tallest mountain in Morocco Mount Everest?â€ ðŸ˜…
> 

**Model reasoning:**

```
That sounds suspicious... ðŸ¤¨ â†’ [RETRIEVE=YES] ðŸ”
(retrieves geography docs ðŸ“„)
```

**Model retrieves:**

- Doc A: â€œToubkal is the highest peak in Morocco and North Africa.â€
- Doc B: â€œMount Everest is located in Nepal.â€

**Model evaluation:**

```
Doc A â†’ [ISREL=1] âœ…
Doc B â†’ [ISREL=1] âœ…
```

**Generated statement:**

> â€œThe tallest mountain in Morocco is Mount Everest.â€ ðŸ”ï¸
> 

**Support check:**

```
No document supports this âŒ â†’ [ISSUP=0] ðŸš«
```

ðŸš« The model realizes the claim is **not supported**, so it **revises** the answer:

> â€œThe tallest mountain in Morocco is Mount Toubkal.â€ â›°ï¸ðŸ‡²ðŸ‡¦ â†’ [ISSUP=1] âœ…
> 

---

### ðŸ’¡ **Summary**

| Token | Meaning | Example | Decision |
| --- | --- | --- | --- |
| `[ISSUP=1]` | Statement is supported by evidence âœ… | Morocco reached semifinals | Keep it |
| `[ISSUP=0]` | Statement not supported ðŸš« | Everest in Morocco | Correct it |

---

### ðŸ§© **In short**

**[ISSUP]** = the modelâ€™s *truth detector* ðŸ•µï¸â€â™‚ï¸ðŸ“–

It ensures every generated fact has **evidence** behind it.

> â€œAm I saying something thatâ€™s actually in the documents?â€ ðŸ§âœ…
> 

---

Hereâ€™s a full and visual explanation of the **[ISUSE]** token â€” with **2 detailed examples** and **emojis** ðŸ‘‡

---

## â­ **[ISUSE] â€” â€œHow useful is this document or sentence for answering the question?â€**

### ðŸ§  **Meaning**

The `[ISUSE]` token measures **how valuable** a piece of information (a document, passage, or sentence) is for producing the *best possible answer* ðŸ†.

Itâ€™s like the model asking itself:

> â€œOkay, this info is relevantâ€¦ but is it actually helpful for answering the user?â€ ðŸ¤”ðŸ’­
> 

---

### âš™ï¸ **When the model uses [ISUSE]**

- After checking **relevance** (`[ISREL]`) and **support** (`[ISSUP]`) âœ…ðŸ“–
- It assigns a **usefulness score** (often from 1 to 5 â­) to show how *strongly* a piece of text contributes to the final answer:

| Token |  |
| --- | --- |
| `[ISUSE=5]` â­â­â­â­â­ â†’ Extremely useful |  |
| `[ISUSE=3]` â­â­â­ â†’ Moderately useful |  |
| `[ISUSE=1]` â­ â†’ Barely useful |  |

This helps the model **prioritize** the most informative parts when generating its response ðŸ’¬âš™ï¸

---

### âš½ **Example 1: Morocco in the 2022 World Cup** ðŸ‡²ðŸ‡¦âš½

> User: â€œWhat was Moroccoâ€™s biggest achievement in the 2022 World Cup?â€ ðŸ†ðŸ‡²ðŸ‡¦
> 

**Model reasoning:**

```
Iâ€™ll need details about Moroccoâ€™s results â†’ [RETRIEVE=YES] ðŸ”
```

**Model retrieves:**

1ï¸âƒ£ Doc A: â€œMorocco became the first African and Arab team to reach the semifinals.â€

2ï¸âƒ£ Doc B: â€œMoroccoâ€™s coach Walid Regragui took charge in August 2022.â€

**Model evaluation:**

```
Doc A â†’ [ISREL=1] âœ… [ISSUP=1] âœ… [ISUSE=5] â­â­â­â­â­
Doc B â†’ [ISREL=1] âœ… [ISSUP=1] âœ… [ISUSE=2] â­â­ (less useful for the question)

```

âœ… **Final generation:**

> â€œ[RETRIEVE] Morocco became the first African and Arab team to reach the semifinals â€” its greatest achievement in 2022. [ISUSE=5] â­â­â­â­â­â€
> 

ðŸ’¡ The model *kept* Doc A because it was **the most useful** for the specific question.

---

### ðŸœï¸ **Example 2: Moroccoâ€™s desert climate** â˜€ï¸ðŸœï¸

> User: â€œDescribe Moroccoâ€™s main climate zones.â€ ðŸŒ¦ï¸ðŸŒµ
> 

**Model reasoning:**

```
Letâ€™s fetch info about Moroccan geography â†’ [RETRIEVE=YES] ðŸ”
```

**Model retrieves:**

1ï¸âƒ£ Doc A: â€œMorocco has a Mediterranean climate in the north and a desert climate in the south.â€

2ï¸âƒ£ Doc B: â€œMoroccoâ€™s national dish is couscous.â€ ðŸ²

**Model evaluation:**

```
Doc A â†’ [ISREL=1] âœ… [ISSUP=1] âœ… [ISUSE=5] â­â­â­â­â­ (directly useful)
Doc B â†’ [ISREL=0] ðŸš« [ISSUP=0] ðŸš« [ISUSE=1] â­ (off-topic)

```

âœ… **Final generation:**

> â€œ[RETRIEVE] Morocco has both Mediterranean and desert climates, creating diverse weather conditions. [ISUSE=5] â­â­â­â­â­â€
> 

ðŸš« The model **ignored Doc B** because it was **irrelevant and not useful** for describing climate.

---

### ðŸ’¡ **Summary**

| Token | Meaning | Example | Action |
| --- | --- | --- | --- |
| `[ISUSE=5]` â­â­â­â­â­ | Extremely useful info | Morocco reached semifinals | Keep |
| `[ISUSE=2]` â­â­ | Minor detail | Coach name | Optional |
| `[ISUSE=1]` â­ | Off-topic | Moroccan food | Ignore |

---


### ðŸ§© **In short**

**[ISUSE]** = the modelâ€™s *priority meter* ðŸŽ¯â­

It helps the model choose **the most helpful evidence** when forming answers â€” filtering whatâ€™s **essential** vs. **extra**.

> â€œThis info is trueâ€¦ but is it actually useful for the userâ€™s question?â€ ðŸ§ ðŸ’¬â­
>

<img width="8948" height="4734" alt="teaser_self_rag_v8" src="https://github.com/user-attachments/assets/eeb94b85-d6d7-4dec-b9bc-15e952c9ea54" />
